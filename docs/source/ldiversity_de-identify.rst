+++++++++++++++++++++++++++++++++++++++
l-多樣性去識別化
+++++++++++++++++++++++++++++++++++++++


以下程式碼旨在對資料進行去識別化以滿足 l-多樣性（l-diversity）。更多 l-多樣性之說明，詳見 `此處 <#l-多樣性之定義>`_ 。

我們以 ``data/adult.csv`` 作爲原始資料，``data/adult_hierarchy`` 目錄作爲資料欄位定義，以及 ``attributeTypes`` 作為屬性型態定義，展示如何透過 PETWorks-framework 框架進行去識別化。

在以下程式碼中，我們透過 API ``PETAnonymization(originalData, tech, dataHierarchy, attributeTypes, maxSuppressionRate, l)``，以上述資料、“l-diversity” 字串、屬性型態定義、最大抑制處理比率 ``maxSuppressionRate`` 、以及整數 l 作爲參數，進行去識別化。

再來，我們透過 API ``report(result, path)``，以上述評估結果與輸出檔案位置 ``path`` 作爲參數，輸出去識別化結果。

範例程式碼: l-diversity.py
---------------------------

.. code-block:: python

  from PETWorks import PETAnonymization, output
  from PETWorks.attributetypes import *
  
  originalData = "data/adult.csv"
  dataHierarchy = "data/adult_hierarchy"
  
  attributeTypes = {
      "age": QUASI_IDENTIFIER,
      "sex": QUASI_IDENTIFIER,
      "workclass": SENSITIVE_ATTRIBUTE,
  }
  
  result = PETAnonymization(
      originalData,
      "l-diversity",
      dataHierarchy,
      attributeTypes,
      maxSuppressionRate=0.6,
      l=6,
  )

  output(result, "output.csv")


輸出結果
---------------------------

上述程式碼將輸出滿足 l = 6 之 l-多樣性去識別化結果至 `output.csv`。檔案內容節錄如下：

+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| sex    | age | race | marital-status | education | native-country | workclass        | occupation | salary-class |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Male   | 37  | \*   | \*             | \*        | \*             | State-gov        | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Male   | 47  | \*   | \*             | \*        | \*             | Self-emp-not-inc | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Male   | 37  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Male   | 52  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Female | 27  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Female | 37  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Female | 47  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Male   | 52  | \*   | \*             | \*        | \*             | Self-emp-not-inc | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Female | 32  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Male   | 42  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Male   | 37  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Male   | 27  | \*   | \*             | \*        | \*             | State-gov        | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Female | 22  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| ...    | ... | ...  | ...            | ...       | ...            | ...              | ...        | ...          |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+


以本專案開發之 `l-多樣性再識別化工具 <https://petworks-doc.readthedocs.io/en/latest/ldiversity.html>`_ 進行檢測，可確認去識別化結果已滿足 l = 6 之 l-多樣性。

.. code-block:: json

  {
      "l": 6,
      "fulfill l-diversity": true
  }


l-多樣性之定義
---------------------------

l-多樣性（l-diversity）是一種隱私保護力指標，表示攻擊者利用個體背景資訊，查詢到的敏感資訊數值是否至少有 l 種。一旦攻擊者查詢到的數值種類過少，可藉由資料表推敲出個體的敏感資訊數值。

而 l 為可調配參數，數值分佈在 1 到無限大之間。數值越高，攻擊者查詢到的數值種類越多，猜中個體敏感資訊數值的機率越低，敏感資訊獲得的保障越大。

去識別化之計算 
---------------------------

本專案之 l-多樣性去識別化功能為串接知名開源工具 ARX 之 Flash 演算法執行，簡述流程如下：

1. 依據使用者參數設定，定義個體背景資訊、敏感資訊等屬性型態。
2. 從去識別化網格各節點通往最高節點的路徑中，找尋滿足 l 值設定、且評分最低的節點。
3. 比較步驟 2. 找尋之節點，選擇評分最低的一個。
4. 依據步驟 3. 選擇之節點，輸出去識別化結果。

詳細請參閱 `此處 <https://hackmd.io/_m52ikVaS1GujvowVEmPFA>`_ 。



